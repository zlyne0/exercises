<!DOCTYPE html>
<html lang="en">
<head>
	<title>product parameters</title>
	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<script src="js/angular.min.js"></script>
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>		
</head>
	
<body>

<div ng-app="productParametersApp" ng-controller="productParametersController as pp">

		<div class="row">
			
			<div class="col-sm-2">
				<table class="table table-bordered table-condensed">
					<thead>
						<tr>
							<th>Product Name</th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="product in products"
							ng-click="pp.setSelectedProduct(product)"
							ng-class="{info: product.id === selectedProduct.id}">
							<td>{{ product.name }}</td>
						</tr>
					</tbody>
				</table>
			</div>
			
			<div class="col-sm-10">
			
				<div ng-if="selectedProduct != null">
					<form class="form-horizontal">
						
						<div class="form-group">
							<label class="control-label col-sm-2" for="parameterTypesId">Typ parametru:</label>
							<div class="col-sm-10">
								<select id="parameterTypesId" class="form-control"									  
									ng-model="newParam.selectedParameterType" 
									ng-options="paramType.name for paramType in parameterTypes">
								</select>							
							</div>
						</div>
						
						<div class="form-group">
							<label class="control-label col-sm-2" for="parameterValueId">Wartość:</label>
							<div class="col-sm-10">
								<input id="parameterValueId" type="text" class="form-control"
									ng-model="newParam.value">							
							</div>
						</div>

						<div class="form-group">
							<label class="control-label col-sm-2" for="parameterBigValueId">Duża wartość:</label>
							<div class="col-sm-10">
								<textarea id="parameterBigValueId" rows="4" cols="50" class="form-control"
									ng-model="newParam.bigValue">
								</textarea>							
							</div>
						</div>

						<div class="form-group">
							<div class="col-sm-offset-2 col-sm-10">
								<button type="submit" class="btn btn-default" ng-click="pp.addParam()">Dodaj</button>
							</div>
						</div>

					</form>
				</div>
			
				selected product: <b>{{ selectedProduct.name }}</b>
				<table class="table table-bordered table-condensed">
					<thead>
						<tr>
							<th>Name</th>
							<th>Value</th>
							<th>Big value</th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="param in productParameters" 
							ng-click="pp.setSelectedParam(param)"
							ng-class="{info: param.id === selectedParam.id}">
							<td>{{ param.type.name }}</td>
							<td>{{ param.value }}</td>
							<td>{{ param.bigValue }}</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	
</div>
	
<script charset="UTF-8">
var app = angular.module('productParametersApp', []);
app.controller('productParametersController', function($scope, $http) {
	$scope.newParam = {};
	
	this.setSelectedProduct = function(product) {
		$scope.selectedProduct = product;
		
		$http.get("rest/product/" + product.id + "/parameters").then(function(response) {
			$scope.productParameters = response.data;
		});
	}
	
	this.setSelectedParam = function(param) {
		$scope.selectedParam = param;
	}
	
	this.loadProductsList = function() {
		$scope.selectedProduct = null;
		$scope.productParameters = [];
		
		$http.get("rest/product/list").then(function(response) {
			$scope.products = response.data;
		});
	}
	
	this.loadProductParametersType = function() {
		$http.get("rest/parameterType/list").then(function(response) {
			$scope.parameterTypes = response.data;
			$scope.newParam.selectedParameterType = $scope.parameterTypes[0];
		});
	}
	
	this.addParam = function() {
		var data = { 
			productId: $scope.selectedProduct.id,
			type: {
				id: $scope.newParam.selectedParameterType.id
			},
			value: $scope.newParam.value, 
			bigValue: $scope.newParam.bigValue 
		};
		$http.post("rest/product/" + $scope.selectedProduct.id + "/addParam", data);
	}
	
	this.loadProductParametersType();
	this.loadProductsList();
});
</script>
	
</body>

</html>